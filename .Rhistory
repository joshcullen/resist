gamma1=0.1
var.betas=c(100,rep(1,ncol(xmat)-1))
mod.res=gibbs_resist(ysoma=ysoma,xmat=xmat,seg.id=seg.id,ngroup=ngroup,
ngibbs=ngibbs,nburn=nburn,var.betas=var.betas,
gamma1=gamma1)
store.llk=mod.res$llk
store.b=mod.res$b.gamma
store.betas=mod.res$betas
z.estim=mod.res$z.estim
plot(store.llk,type='l')
nburn=1000
abline(v=nburn,col='red')
plot(store.llk[nburn:ngibbs],type='l')
nburn=2000
abline(v=nburn,col='red')
plot(store.llk[nburn:ngibbs],type='l')
nburn=3000
abline(v=nburn,col='red')
plot(store.llk[nburn:ngibbs],type='l')
plot(store.b,type='l')
plot(store.b[nburn:ngibbs],type='l')
par(mfrow=c(3,3),mar=rep(1,4))
ind=sample(1:ncol(store.betas),size=9)
for (i in 1:9) plot(store.betas[1:ngibbs,ind[i]],type='l')
for (i in 1:9) plot(store.betas[nburn:ngibbs,ind[i]],type='l')
fim=data.frame(z.estim=z.estim,z.true=z.true)
tab1=table(fim); tab1
set.seed(111)
setwd('U:\\GIT_models\\resist')
n=50000
nparam=4
xmat=matrix(runif(n*nparam,min=-1.5,max=1.5),n,nparam)
nomes.cov=paste0('covs',1:nparam)
colnames(xmat)=nomes.cov
n=nrow(xmat)
ngroup=5
betas.true=betas=matrix(c(-1,0 ,1,-1,0,
1,0 ,1,-1,1,
-1,-1,0, 0,0,
0, 0,-1,1,1),nparam+1,ngroup,byrow=T)
media=exp(cbind(1,xmat)%*%betas); range(round(media,3))
b.true=b=4
a=b*media
ymat=matrix(rgamma(n*ngroup,a,b),n,ngroup); range(ymat)
fim=as.data.frame(xmat)
fim$z=NA
fim$ysoma=NA
fim$seg.id=NA
#aggregate these data
ind=floor(c(seq(from=1,to=n,by=n/1000),n+1)) #has to include 1 and n to use all observations
for (i in 2:length(ind)){
seq1=ind[i-1]:(ind[i]-1)
n=length(seq1)
fim$seg.id[seq1]=i-1
z=sample(1:ngroup,size=1)
fim$z[ind[i]-1]=z
ysoma=ymat[seq1,z]
fim$ysoma[ind[i]-1]=sum(ysoma)
}
max(fim$seg.id)
length(unique(fim$seg.id))
#get z.true
tmp=unique(fim[,c('z','seg.id')])
z.true=tmp[!is.na(tmp$z),'z']
table(z.true)
fim=data.frame(z.estim=z.estim,z.true=z.true)
tab1=table(fim); tab1
ordem=numeric()
for (i in 1:ncol(tab1)){
ind=which(tab1[,i]==max(tab1[,i]))
ordem=c(ordem,ind)
}
tab1[ordem,]
#look at betas
ngroup=10
par(mfrow=c(1,1),mar=rep(3,4))
betas.estim=matrix(store.betas[ngibbs,],ncol(store.betas)/ngroup,ngroup)
rango=range(c(betas.estim,betas.true))
plot(betas.true,betas.estim[,ordem],xlim=rango,ylim=rango)
lines(rango,rango,col='red')
ngroup=10
par(mfrow=c(1,1),mar=rep(3,4))
betas.estim=matrix(store.betas[ngibbs,],ncol(store.betas)/ngroup,ngroup)
rango=range(c(betas.estim[,ordem],betas.true))
plot(betas.true,betas.estim[,ordem],xlim=rango,ylim=rango)
lines(rango,rango,col='red')
#look at theta
theta.estim=apply(mod.res$theta[nburn:ngibbs,],2,mean)
plot(theta.estim,type='h',ylim=c(0,1))
rm(list=ls())
set.seed(111)
setwd('U:\\GIT_models\\resist')
n=50000
nparam=4
xmat=matrix(runif(n*nparam,min=-1.5,max=1.5),n,nparam)
nomes.cov=paste0('covs',1:nparam)
colnames(xmat)=nomes.cov
n=nrow(xmat)
ngroup=7
betas.true=betas=matrix(c(-1,0 ,1,-1,0,
1,0 ,1,-1,1,
-1,-1,0, 0,0,
0, 0,-1,1,1),nparam+1,ngroup,byrow=T)
media=exp(cbind(1,xmat)%*%betas); range(round(media,3))
b.true=b=4
a=b*media
ymat=matrix(rgamma(n*ngroup,a,b),n,ngroup); range(ymat)
fim=as.data.frame(xmat)
fim$z=NA
fim$ysoma=NA
fim$seg.id=NA
#aggregate these data
ind=floor(c(seq(from=1,to=n,by=n/1000),n+1)) #has to include 1 and n to use all observations
for (i in 2:length(ind)){
seq1=ind[i-1]:(ind[i]-1)
n=length(seq1)
fim$seg.id[seq1]=i-1
z=sample(1:ngroup,size=1)
fim$z[ind[i]-1]=z
ysoma=ymat[seq1,z]
fim$ysoma[ind[i]-1]=sum(ysoma)
}
max(fim$seg.id)
length(unique(fim$seg.id))
#get z.true
tmp=unique(fim[,c('z','seg.id')])
z.true=tmp[!is.na(tmp$z),'z']
table(z.true)
rm(list=ls())
set.seed(111)
setwd('U:\\GIT_models\\resist')
n=50000
nparam=4
xmat=matrix(runif(n*nparam,min=-1.5,max=1.5),n,nparam)
nomes.cov=paste0('covs',1:nparam)
colnames(xmat)=nomes.cov
n=nrow(xmat)
ngroup=6
betas.true=betas=matrix(c(-1,0 , 1,-1, 0,1,
1,0 , 1,-1, 1,0,
-1,-1, 0, 0, 0,-1
0, 0,-1, 1,-1,0),nparam+1,ngroup,byrow=T)
rm(list=ls())
set.seed(111)
setwd('U:\\GIT_models\\resist')
n=50000
nparam=4
xmat=matrix(runif(n*nparam,min=-1.5,max=1.5),n,nparam)
nomes.cov=paste0('covs',1:nparam)
colnames(xmat)=nomes.cov
n=nrow(xmat)
ngroup=7
betas.true=betas=matrix(c(-1,0 , 1,-1, 0, 1, 0,
1,0 , 1,-1, 1, 0,-1,
-1,-1, 0, 0, 0,-1, 0,
0, 0,-1, 1,-1, 0, 1),nparam+1,ngroup,byrow=T)
media=exp(cbind(1,xmat)%*%betas); range(round(media,3))
length(c(-1,0 , 1,-1, 0, 1, 0,
1,0 , 1,-1, 1, 0,-1,
-1,-1, 0, 0, 0,-1, 0,
0, 0,-1, 1,-1, 0, 1))
rm(list=ls())
set.seed(111)
setwd('U:\\GIT_models\\resist')
n=50000
nparam=3
xmat=matrix(runif(n*nparam,min=-1.5,max=1.5),n,nparam)
nomes.cov=paste0('covs',1:nparam)
colnames(xmat)=nomes.cov
n=nrow(xmat)
ngroup=7
betas.true=betas=matrix(c(-1,0 , 1,-1, 0, 1, 0,
1,0 , 1,-1, 1, 0,-1,
-1,-1, 0, 0, 0,-1, 0,
0, 0,-1, 1,-1, 0, 1),nparam+1,ngroup,byrow=T)
media=exp(cbind(1,xmat)%*%betas); range(round(media,3))
rm(list=ls())
set.seed(111)
setwd('U:\\GIT_models\\resist')
n=50000
nparam=3
xmat=matrix(runif(n*nparam,min=-1.5,max=1.5),n,nparam)
nomes.cov=paste0('covs',1:nparam)
colnames(xmat)=nomes.cov
n=nrow(xmat)
ngroup=7
betas.true=betas=matrix(c(-1,0 , 1,-1, 0, 1, 0,
1,0 , 1,-1, 1, 0,-1,
-1,-1, 0, 0, 0,-1, 0,
0, 0,-1, 1,-1, 0, 1),nparam+1,ngroup,byrow=T)
media=exp(cbind(1,xmat)%*%betas); range(round(media,3))
b.true=b=1
a=b*media
ymat=matrix(rgamma(n*ngroup,a,b),n,ngroup); range(ymat)
fim=as.data.frame(xmat)
fim$z=NA
fim$ysoma=NA
fim$seg.id=NA
#aggregate these data
ind=floor(c(seq(from=1,to=n,by=n/1000),n+1)) #has to include 1 and n to use all observations
for (i in 2:length(ind)){
seq1=ind[i-1]:(ind[i]-1)
n=length(seq1)
fim$seg.id[seq1]=i-1
z=sample(1:ngroup,size=1)
fim$z[ind[i]-1]=z
ysoma=ymat[seq1,z]
fim$ysoma[ind[i]-1]=sum(ysoma)
}
max(fim$seg.id)
length(unique(fim$seg.id))
#get z.true
tmp=unique(fim[,c('z','seg.id')])
z.true=tmp[!is.na(tmp$z),'z']
table(z.true)
#export results
ind=which(colnames(fim)=='z')
setwd('U:\\GIT_models\\resist')
write.csv(fim[,-ind],'fake data.csv',row.names=F)
rm(list=ls())
library('Rcpp')
set.seed(111)
setwd('U:\\GIT_models\\resist')
source('gibbs_resist.R')
source('gibbs_resist_func.R')
sourceCpp('resist_aux.cpp')
dat=read.csv('fake data.csv',as.is=T)
ind=grep('cov',colnames(dat))
xmat=data.matrix(cbind(1,dat[,ind]))
seg.id=dat$seg.id
ngroup=10
#get y soma
tmp=unique(dat[,c('seg.id','ysoma')])
cond=!is.na(tmp$ysoma)
ysoma=tmp[cond,'ysoma']
ngibbs=10000
nburn=ngibbs/2
#priors
gamma1=0.1
var.betas=c(100,rep(1,ncol(xmat)-1))
mod.res=gibbs_resist(ysoma=ysoma,xmat=xmat,seg.id=seg.id,ngroup=ngroup,
ngibbs=ngibbs,nburn=nburn,var.betas=var.betas,
gamma1=gamma1)
rm(list=ls())
library('Rcpp')
set.seed(121)
setwd('U:\\GIT_models\\resist')
source('gibbs_resist.R')
source('gibbs_resist_func.R')
sourceCpp('resist_aux.cpp')
dat=read.csv('fake data.csv',as.is=T)
ind=grep('cov',colnames(dat))
xmat=data.matrix(cbind(1,dat[,ind]))
seg.id=dat$seg.id
ngroup=10
#get y soma
tmp=unique(dat[,c('seg.id','ysoma')])
cond=!is.na(tmp$ysoma)
ysoma=tmp[cond,'ysoma']
ngibbs=10000
nburn=ngibbs/2
#priors
gamma1=0.1
var.betas=c(100,rep(1,ncol(xmat)-1))
mod.res=gibbs_resist(ysoma=ysoma,xmat=xmat,seg.id=seg.id,ngroup=ngroup,
ngibbs=ngibbs,nburn=nburn,var.betas=var.betas,
gamma1=gamma1)
rm(list=ls())
set.seed(131)
setwd('U:\\GIT_models\\resist')
n=50000
nparam=3
xmat=matrix(runif(n*nparam,min=-1.5,max=1.5),n,nparam)
nomes.cov=paste0('covs',1:nparam)
colnames(xmat)=nomes.cov
n=nrow(xmat)
ngroup=7
betas.true=betas=matrix(c(-1,0 , 1,-1, 0, 1, 0,
1,0 , 1,-1, 1, 0,-1,
-1,-1, 0, 0, 0,-1, 0,
0, 0,-1, 1,-1, 0, 1),nparam+1,ngroup,byrow=T)
media=exp(cbind(1,xmat)%*%betas); range(round(media,3))
b.true=b=1
a=b*media
ymat=matrix(rgamma(n*ngroup,a,b),n,ngroup); range(ymat)
fim=as.data.frame(xmat)
fim$z=NA
fim$ysoma=NA
fim$seg.id=NA
#aggregate these data
ind=floor(c(seq(from=1,to=n,by=n/1000),n+1)) #has to include 1 and n to use all observations
for (i in 2:length(ind)){
seq1=ind[i-1]:(ind[i]-1)
n=length(seq1)
fim$seg.id[seq1]=i-1
z=sample(1:ngroup,size=1)
fim$z[ind[i]-1]=z
ysoma=ymat[seq1,z]
fim$ysoma[ind[i]-1]=sum(ysoma)
}
max(fim$seg.id)
length(unique(fim$seg.id))
#get z.true
tmp=unique(fim[,c('z','seg.id')])
z.true=tmp[!is.na(tmp$z),'z']
table(z.true)
#export results
ind=which(colnames(fim)=='z')
setwd('U:\\GIT_models\\resist')
write.csv(fim[,-ind],'fake data.csv',row.names=F)
rm(list=ls())
library('Rcpp')
set.seed(121)
setwd('U:\\GIT_models\\resist')
source('gibbs_resist.R')
source('gibbs_resist_func.R')
sourceCpp('resist_aux.cpp')
dat=read.csv('fake data.csv',as.is=T)
ind=grep('cov',colnames(dat))
xmat=data.matrix(cbind(1,dat[,ind]))
seg.id=dat$seg.id
ngroup=10
#get y soma
tmp=unique(dat[,c('seg.id','ysoma')])
cond=!is.na(tmp$ysoma)
ysoma=tmp[cond,'ysoma']
ngibbs=10000
nburn=ngibbs/2
#priors
gamma1=0.1
var.betas=c(100,rep(1,ncol(xmat)-1))
mod.res=gibbs_resist(ysoma=ysoma,xmat=xmat,seg.id=seg.id,ngroup=ngroup,
ngibbs=ngibbs,nburn=nburn,var.betas=var.betas,
gamma1=gamma1)
store.llk=mod.res$llk
store.b=mod.res$b.gamma
store.betas=mod.res$betas
z.estim=mod.res$z.estim
#look at overall convergence
plot(store.llk,type='l')
nburn=3000
abline(v=nburn,col='red')
plot(store.llk[nburn:ngibbs],type='l')
plot(store.b,type='l')
plot(store.b[nburn:ngibbs],type='l')
par(mfrow=c(3,3),mar=rep(1,4))
ind=sample(1:ncol(store.betas),size=9)
for (i in 1:9) plot(store.betas[1:ngibbs,ind[i]],type='l')
for (i in 1:9) plot(store.betas[nburn:ngibbs,ind[i]],type='l')
fim=data.frame(z.estim=z.estim,z.true=z.true)
tab1=table(fim); tab1
set.seed(131)
setwd('U:\\GIT_models\\resist')
n=50000
nparam=3
xmat=matrix(runif(n*nparam,min=-1.5,max=1.5),n,nparam)
nomes.cov=paste0('covs',1:nparam)
colnames(xmat)=nomes.cov
n=nrow(xmat)
ngroup=7
betas.true=betas=matrix(c(-1,0 , 1,-1, 0, 1, 0,
1,0 , 1,-1, 1, 0,-1,
-1,-1, 0, 0, 0,-1, 0,
0, 0,-1, 1,-1, 0, 1),nparam+1,ngroup,byrow=T)
media=exp(cbind(1,xmat)%*%betas); range(round(media,3))
b.true=b=1
a=b*media
ymat=matrix(rgamma(n*ngroup,a,b),n,ngroup); range(ymat)
fim=as.data.frame(xmat)
fim$z=NA
fim$ysoma=NA
fim$seg.id=NA
#aggregate these data
ind=floor(c(seq(from=1,to=n,by=n/1000),n+1)) #has to include 1 and n to use all observations
for (i in 2:length(ind)){
seq1=ind[i-1]:(ind[i]-1)
n=length(seq1)
fim$seg.id[seq1]=i-1
z=sample(1:ngroup,size=1)
fim$z[ind[i]-1]=z
ysoma=ymat[seq1,z]
fim$ysoma[ind[i]-1]=sum(ysoma)
}
max(fim$seg.id)
length(unique(fim$seg.id))
#get z.true
tmp=unique(fim[,c('z','seg.id')])
z.true=tmp[!is.na(tmp$z),'z']
table(z.true)
fim=data.frame(z.estim=z.estim,z.true=z.true)
tab1=table(fim); tab1
ordem=numeric()
for (i in 1:ncol(tab1)){
ind=which(tab1[,i]==max(tab1[,i]))
ordem=c(ordem,ind)
}
tab1[ordem,]
#look at betas
ngroup=10
par(mfrow=c(1,1),mar=rep(3,4))
betas.estim=matrix(store.betas[ngibbs,],ncol(store.betas)/ngroup,ngroup)
rango=range(c(betas.estim[,ordem],betas.true))
plot(betas.true,betas.estim[,ordem],xlim=rango,ylim=rango)
lines(rango,rango,col='red')
#look at theta
theta.estim=apply(mod.res$theta[nburn:ngibbs,],2,mean)
plot(theta.estim,type='h',ylim=c(0,1))
set.seed(131)
n=50000
nparam=3
xmat=matrix(runif(n*nparam,min=-1.5,max=1.5),n,nparam)
dim(xmat)
nomes.cov=paste0('covs',1:nparam)
colnames(xmat)=nomes.cov
n=nrow(xmat)
ngroup=7
betas.true=betas=matrix(c(-1,0 , 1,-1, 0, 1, 0,
1,0 , 1,-1, 1, 0,-1,
-1,-1, 0, 0, 0,-1, 0,
0, 0,-1, 1,-1, 0, 1),nparam+1,ngroup,byrow=T)
betas.true
media=exp(cbind(1,xmat)%*%betas); range(round(media,3))
dim(media)
media[1:5,]
b.true=b=1
a=b*media
ymat=matrix(rgamma(n*ngroup,a,b),n,ngroup); range(ymat)
fim=as.data.frame(xmat)
fim$z=NA
fim$ysoma=NA
fim$seg.id=NA
#aggregate these data
ind=floor(c(seq(from=1,to=n,by=n/1000),n+1)) #has to include 1 and n to use all observations
for (i in 2:length(ind)){
seq1=ind[i-1]:(ind[i]-1)
n=length(seq1)
fim$seg.id[seq1]=i-1
z=sample(1:ngroup,size=1)
fim$z[ind[i]-1]=z
ysoma=ymat[seq1,z]
fim$ysoma[ind[i]-1]=sum(ysoma)
}
max(fim$seg.id)
length(unique(fim$seg.id))
#get z.true
tmp=unique(fim[,c('z','seg.id')])
z.true=tmp[!is.na(tmp$z),'z']
table(z.true)
#export results
ind=which(colnames(fim)=='z')
library('Rcpp')
set.seed(121)
source('gibbs_resist.R')
source('gibbs_resist_func.R')
sourceCpp('resist_aux.cpp')
dat=read.csv('fake data.csv',as.is=T)
View(dat)
ind=grep('cov',colnames(dat))
xmat=data.matrix(cbind(1,dat[,ind]))
seg.id=dat$seg.id
ngroup=10
#get y soma
tmp=unique(dat[,c('seg.id','ysoma')])
cond=!is.na(tmp$ysoma)
ysoma=tmp[cond,'ysoma']
ngibbs=10000
nburn=ngibbs/2
#priors
gamma1=0.1
var.betas=c(100,rep(1,ncol(xmat)-1))
mod.res=gibbs_resist(ysoma=ysoma,xmat=xmat,seg.id=seg.id,ngroup=ngroup,
ngibbs=ngibbs,nburn=nburn,var.betas=var.betas,
gamma1=gamma1)
store.llk=mod.res$llk
store.b=mod.res$b.gamma
store.betas=mod.res$betas
z.estim=mod.res$z.estim
#look at overall convergence
plot(store.llk,type='l')
nburn=3000
abline(v=nburn,col='red')
plot(store.llk[nburn:ngibbs],type='l')
plot(store.b,type='l')
plot(store.b[nburn:ngibbs],type='l')
#look at convergence betas
par(mfrow=c(3,3),mar=rep(1,4))
ind=sample(1:ncol(store.betas),size=9)
for (i in 1:9) plot(store.betas[1:ngibbs,ind[i]],type='l')
for (i in 1:9) plot(store.betas[nburn:ngibbs,ind[i]],type='l')
#look at z's
fim=data.frame(z.estim=z.estim,z.true=z.true)
tab1=table(fim); tab1
ordem=numeric()
for (i in 1:ncol(tab1)){
ind=which(tab1[,i]==max(tab1[,i]))
ordem=c(ordem,ind)
}
tab1[ordem,]
#look at betas
ngroup=10
par(mfrow=c(1,1),mar=rep(3,4))
betas.estim=matrix(store.betas[ngibbs,],ncol(store.betas)/ngroup,ngroup)
rango=range(c(betas.estim[,ordem],betas.true))
plot(betas.true,betas.estim[,ordem],xlim=rango,ylim=rango)
lines(rango,rango,col='red')
#look at theta
theta.estim=apply(mod.res$theta[nburn:ngibbs,],2,mean)
plot(theta.estim,type='h',ylim=c(0,1))
#look at convergence betas
par(mfrow=c(3,3),mar=rep(1,4))
ind=sample(1:ncol(store.betas),size=9)
for (i in 1:9) plot(store.betas[1:ngibbs,ind[i]],type='l')
